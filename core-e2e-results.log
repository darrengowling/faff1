
> app@1.0.0 test:core-e2e
> bash scripts/run-core-e2e.sh

🧪 Running Core E2E Test Suite...
🔄 Running tests/e2e/auth_ui.spec.ts...
🧪 Global E2E Test Setup Starting...
✅ Application accessible at: https://pifa-league.preview.emergentagent.com (Status: 200)
🎉 Global setup completed successfully!

Running 15 tests using 1 worker

[1A[2K[1/15] [chromium] › tests/e2e/auth_ui.spec.ts:11:7 › Authentication UI Tests › Login page renders form with all required testid elements
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:11:7 › Authentication UI Tests › Login page renders form with all required testid elements
✅ Login form renders correctly with all required testid elements

[1A[2K[2/15] [chromium] › tests/e2e/auth_ui.spec.ts:41:7 › Authentication UI Tests › Submit button is disabled for invalid email
[1A[2K[3/15] [chromium] › tests/e2e/auth_ui.spec.ts:65:7 › Authentication UI Tests › Shows error for invalid email submission
[1A[2K  1) [chromium] › tests/e2e/auth_ui.spec.ts:65:7 › Authentication UI Tests › Shows error for invalid email submission 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

    Locator:  locator('[data-testid="auth-error"]')
    Expected: visible
    Received: <element(s) not found>
    Timeout:  10000ms

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('[data-testid="auth-error"]')[22m


      77 |     
      78 |     // Error should be visible
    > 79 |     await expect(errorElement).toBeVisible();
         |                                ^
      80 |     await expect(errorElement).toContainText('valid email address');
      81 |   });
      82 |
        at /app/tests/e2e/auth_ui.spec.ts:79:32

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--bde9a-or-invalid-email-submission-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--bde9a-or-invalid-email-submission-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--bde9a-or-invalid-email-submission-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--bde9a-or-invalid-email-submission-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--bde9a-or-invalid-email-submission-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[4/15] [chromium] › tests/e2e/auth_ui.spec.ts:83:7 › Authentication UI Tests › Successfully submits valid email and shows success
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:83:7 › Authentication UI Tests › Successfully submits valid email and shows success
Browser Console: Failed to load resource: the server responded with a status of 500 ()

[1A[2KBrowser Console: Magic link request failed: AxiosError

[1A[2K  2) [chromium] › tests/e2e/auth_ui.spec.ts:83:7 › Authentication UI Tests › Successfully submits valid email and shows success 

    TimeoutError: page.waitForResponse: Timeout 10000ms exceeded while waiting for event "response"

       97 |     
       98 |     // Wait for network requests to complete
    >  99 |     const responsePromise = page.waitForResponse(response => 
          |                                  ^
      100 |       response.url().includes('/api/auth/magic-link') && response.status() === 200
      101 |     );
      102 |     
        at /app/tests/e2e/auth_ui.spec.ts:99:34

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--ca713-lid-email-and-shows-success-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--ca713-lid-email-and-shows-success-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--ca713-lid-email-and-shows-success-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--ca713-lid-email-and-shows-success-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--ca713-lid-email-and-shows-success-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[5/15] [chromium] › tests/e2e/auth_ui.spec.ts:127:7 › Authentication UI Tests › Back to Home navigation works
[1A[2K[6/15] [chromium] › tests/e2e/auth_ui.spec.ts:137:7 › Authentication UI Tests › Form handles loading state correctly
[1A[2K  3) [chromium] › tests/e2e/auth_ui.spec.ts:137:7 › Authentication UI Tests › Form handles loading state correctly 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('[data-testid="auth-submit-btn"]')
    Expected string: [32m"Send[7ming[27m Magic Link"[39m
    Received string: [31m"Send Magic Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('[data-testid="auth-submit-btn"]')[22m
    [2m    14 × locator resolved to <button type="submit" data-testid="auth-submit-btn" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 text-primary-foreground shadow h-9 px-4 py-2 w-full bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 transition-all duration-200">…</button>[22m
    [2m       - unexpected value "Send Magic Link"[22m


      146 |     
      147 |     // Button should show loading text and be disabled
    > 148 |     await expect(submitBtn).toContainText('Sending Magic Link');
          |                             ^
      149 |     await expect(submitBtn).toBeDisabled();
      150 |   });
      151 |
        at /app/tests/e2e/auth_ui.spec.ts:148:29

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--050d0-les-loading-state-correctly-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--050d0-les-loading-state-correctly-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--050d0-les-loading-state-correctly-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--050d0-les-loading-state-correctly-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--050d0-les-loading-state-correctly-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[7/15] [chromium] › tests/e2e/auth_ui.spec.ts:152:7 › Authentication UI Tests › No dead ends - page always has navigation options
[1A[2K  4) [chromium] › tests/e2e/auth_ui.spec.ts:152:7 › Authentication UI Tests › No dead ends - page always has navigation options 

    Error: expect.toBeVisible: Error: strict mode violation: locator('header') resolved to 2 elements:
        1) <header class="sticky top-0 w-full bg-theme-surface/95 backdrop-blur-sm border-b border-theme-surface-border z-50">…</header> aka getByText('Friends of PIFASign InGet StartedSkip to main content')
        2) <header data-testid="login-header" class="bg-white shadow-sm border-b">…</header> aka getByTestId('login-header')

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('header')[22m


      152 |   test('No dead ends - page always has navigation options', async ({ page }) => {
      153 |     // Verify header is present
    > 154 |     await expect(page.locator('header')).toBeVisible();
          |                                          ^
      155 |     
      156 |     // Verify back to home link is always present
      157 |     await expect(page.locator('[data-testid="back-to-home-link"]')).toBeVisible();
        at /app/tests/e2e/auth_ui.spec.ts:154:42

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--6e953-ways-has-navigation-options-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--6e953-ways-has-navigation-options-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--6e953-ways-has-navigation-options-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--6e953-ways-has-navigation-options-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--6e953-ways-has-navigation-options-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[8/15] [chromium] › tests/e2e/auth_ui.spec.ts:170:7 › Authentication UI Tests › Test mode disables animations
[1A[2K  5) [chromium] › tests/e2e/auth_ui.spec.ts:170:7 › Authentication UI Tests › Test mode disables animations 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

    Locator:  locator('[data-testid="auth-success"]')
    Expected: visible
    Received: <element(s) not found>
    Timeout:  3000ms

    Call log:
    [2m  - Expect "toBeVisible" with timeout 3000ms[22m
    [2m  - waiting for locator('[data-testid="auth-success"]')[22m


      183 |     
      184 |     // Success state should appear quickly in test mode
    > 185 |     await expect(page.locator(`[data-testid="${TESTIDS.authSuccess}"]`)).toBeVisible({ timeout: 3000 });
          |                                                                          ^
      186 |   });
      187 | });
      188 |
        at /app/tests/e2e/auth_ui.spec.ts:185:74

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--d42bf-st-mode-disables-animations-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--d42bf-st-mode-disables-animations-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--d42bf-st-mode-disables-animations-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--d42bf-st-mode-disables-animations-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--d42bf-st-mode-disables-animations-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[9/15] [chromium] › tests/e2e/auth_ui.spec.ts:190:7 › Authentication UI Integration › Form submission works using only testids
[1A[2K  6) [chromium] › tests/e2e/auth_ui.spec.ts:190:7 › Authentication UI Integration › Form submission works using only testids 

    TimeoutError: page.waitForURL: Timeout 10000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "**/auth/verify" until "load"
    ============================================================

      212 |     await Promise.race([
      213 |       successMsg.waitFor({ state: 'visible', timeout: 10000 }),
    > 214 |       page.waitForURL('**/auth/verify', { timeout: 10000 }),
          |            ^
      215 |       page.waitForURL('**/app', { timeout: 10000 })
      216 |     ]);
      217 |     
        at /app/tests/e2e/auth_ui.spec.ts:214:12

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--828c5-on-works-using-only-testids-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--828c5-on-works-using-only-testids-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--828c5-on-works-using-only-testids-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--828c5-on-works-using-only-testids-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--828c5-on-works-using-only-testids-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[10/15] [chromium] › tests/e2e/auth_ui.spec.ts:221:7 › Authentication UI Integration › Complete auth flow using UI login mode
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:221:7 › Authentication UI Integration › Complete auth flow using UI login mode
🔐 Logging in user: ui-integration-test@example.com (mode: ui)

[1A[2K🖱️  UI login for user: ui-integration-test@example.com

[1A[2K❌ UI login failed for ui-integration-test@example.com: page.waitForResponse: Timeout 15000ms exceeded while waiting for event "response"
    at loginUI [90m(/app/[39mtests/e2e/utils/login.ts:99:34[90m)[39m
    at login [90m(/app/[39mtests/e2e/utils/login.ts:30:5[90m)[39m
    at [90m/app/[39mtests/e2e/auth_ui.spec.ts:226:5 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'/app/tests/e2e/utils/login.ts'[39m,
      line: [33m99[39m,
      column: [33m34[39m,
      function: [32m'loginUI'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for event "response"'[39m,
    apiName: [32m'page.waitForResponse'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@38'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@38'[39m,
      _title: [32m'Wait for event "response"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1759029855322[39m,
    error: {
      message: [32m'TimeoutError: page.waitForResponse: Timeout 15000ms exceeded while waiting for event "response"'[39m,
      stack: [32m'TimeoutError: page.waitForResponse: Timeout 15000ms exceeded while waiting for event "response"\n'[39m +
        [32m'    at loginUI (/app/tests/e2e/utils/login.ts:99:34)\n'[39m +
        [32m'    at login (/app/tests/e2e/utils/login.ts:30:5)\n'[39m +
        [32m'    at /app/tests/e2e/auth_ui.spec.ts:226:5'[39m,
      cause: [90mundefined[39m
    }
  }
}

[1A[2K  7) [chromium] › tests/e2e/auth_ui.spec.ts:221:7 › Authentication UI Integration › Complete auth flow using UI login mode 

    TimeoutError: page.waitForResponse: Timeout 15000ms exceeded while waiting for event "response"

       at utils/login.ts:99

       97 |     
       98 |     // Wait for network response
    >  99 |     const responsePromise = page.waitForResponse(response => 
          |                                  ^
      100 |       response.url().includes('/api/auth/magic-link') && response.status() === 200,
      101 |       { timeout }
      102 |     );
        at loginUI (/app/tests/e2e/utils/login.ts:99:34)
        at login (/app/tests/e2e/utils/login.ts:30:5)
        at /app/tests/e2e/auth_ui.spec.ts:226:5

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--e447d-th-flow-using-UI-login-mode-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--e447d-th-flow-using-UI-login-mode-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: test-results/auth_ui-Authentication-UI--e447d-th-flow-using-UI-login-mode-chromium/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--e447d-th-flow-using-UI-login-mode-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--e447d-th-flow-using-UI-login-mode-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[11/15] [chromium] › tests/e2e/auth_ui.spec.ts:233:7 › Authentication UI Integration › Shows error for empty email with proper UX
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:233:7 › Authentication UI Integration › Shows error for empty email with proper UX
🧪 Testing empty email error handling...

[1A[2K  8) [chromium] › tests/e2e/auth_ui.spec.ts:233:7 › Authentication UI Integration › Shows error for empty email with proper UX 

    TimeoutError: locator.fill: Timeout 10000ms exceeded.
    Call log:
    [2m  - waiting for locator('[data-testid="auth-email-input"]')[22m


      239 |
      240 |     // Submit with empty email (form validation should prevent this, but test anyway)
    > 241 |     await emailInput.fill('');
          |                      ^
      242 |     await expect(submitBtn).toBeDisabled();
      243 |     
      244 |     // Add some text then clear it to test error behavior
        at /app/tests/e2e/auth_ui.spec.ts:241:22

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--2725b--empty-email-with-proper-UX-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--2725b--empty-email-with-proper-UX-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #3: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--2725b--empty-email-with-proper-UX-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--2725b--empty-email-with-proper-UX-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[12/15] [chromium] › tests/e2e/auth_ui.spec.ts:254:7 › Authentication UI Integration › Shows error for invalid email format with concise message
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:254:7 › Authentication UI Integration › Shows error for invalid email format with concise message
🧪 Testing invalid email error handling...

[1A[2K  9) [chromium] › tests/e2e/auth_ui.spec.ts:254:7 › Authentication UI Integration › Shows error for invalid email format with concise message 

    TimeoutError: locator.fill: Timeout 10000ms exceeded.
    Call log:
    [2m  - waiting for locator('[data-testid="auth-email-input"]')[22m


      260 |
      261 |     // Enter invalid email and try to submit
    > 262 |     await emailInput.fill('invalid-email-format');
          |                      ^
      263 |     
      264 |     // Button should be disabled for invalid email
      265 |     await expect(submitBtn).toBeDisabled();
        at /app/tests/e2e/auth_ui.spec.ts:262:22

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--fbee4-format-with-concise-message-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: video (video/webm) ──────────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--fbee4-format-with-concise-message-chromium/video.webm
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #3: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--fbee4-format-with-concise-message-chromium/trace.zip
    Usage:

        npx playwright show-trace test-results/auth_ui-Authentication-UI--fbee4-format-with-concise-message-chromium/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[13/15] [chromium] › tests/e2e/auth_ui.spec.ts:300:7 › Authentication UI Integration › Error clears when user starts typing
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:300:7 › Authentication UI Integration › Error clears when user starts typing
🧪 Testing error clearing behavior...

[1A[2K  10) [chromium] › tests/e2e/auth_ui.spec.ts:300:7 › Authentication UI Integration › Error clears when user starts typing 

    TimeoutError: locator.fill: Timeout 10000ms exceeded.
    Call log:
    [2m  - waiting for locator('[data-testid="auth-email-input"]')[22m


      306 |
      307 |     // Enter email that might trigger error
    > 308 |     await emailInput.fill('error-test@invaliddomain999.com');
          |                      ^
      309 |     await submitBtn.click();
      310 |     
      311 |     // Wait a moment for any potential error
        at /app/tests/e2e/auth_ui.spec.ts:308:22

    Error: apiRequestContext._wrapApiCall: ENOENT: no such file or directory, open '/app/test-results/.playwright-artifacts-9/traces/03a6b9075963f640fefd-c7318167fe6268fc0bef.trace'

    Error: ENOENT: no such file or directory, open '/app/test-results/.playwright-artifacts-9/1ddf15263b40bf2d4cb85dc4e2eb2a46.zip'

    [31mTest timeout of 60000ms exceeded.[39m

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    test-results/auth_ui-Authentication-UI--b7efb-ars-when-user-starts-typing-chromium/test-failed-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────


[1A[2K[14/15] [chromium] › tests/e2e/auth_ui.spec.ts:329:7 › Authentication UI Integration › Submit button states work correctly during loading
[1A[2K[chromium] › tests/e2e/auth_ui.spec.ts:329:7 › Authentication UI Integration › Submit button states work correctly during loading
🧪 Testing submit button states...

